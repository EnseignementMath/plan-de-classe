<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Plan de classe - Grille interactive</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: #eaf6fd; }
    h1 { text-align: center; margin: 24px 0 12px 0; }
    .setup { text-align: center; margin-bottom: 20px; }
    .setup label { font-weight: bold; }
    .setup input, .setup textarea { font-size: 1.1em; }
    .mainzone { display: flex; justify-content: center; gap: 32px; align-items: flex-start; }
    .eleve-list {
      min-width: 180px; background: #fff; border-radius: 12px;
      padding: 12px 10px; box-shadow: 0 2px 16px #0001; min-height: 200px;
      display: flex; flex-direction: column; gap: 7px; margin-top: 6px;
      max-height: 78vh; overflow-y: auto;
    }
    .eleve {
      background: #c4ecfc; border-radius: 8px; padding: 7px 15px;
      font-weight: bold; font-size: 1.08em; cursor: grab; user-select: none;
      border: 1.5px solid #a7cfea;
      transition: background 0.15s;
      box-shadow: 0 1px 5px #0001;
      text-align: center;
    }
    .eleve:active { background: #96e3d9;}
    .grille {
      background: #e2f1fb; border-radius: 14px; box-shadow: 0 2px 18px #0002;
      padding: 20px; overflow: auto; max-width: 92vw; max-height: 81vh;
      margin-top: 8px;
    }
    .grille-table {
      border-collapse: separate; border-spacing: 8px;
      width: 100%; table-layout: fixed; min-width: 320px;
    }
    .grille-table td {
      background: #b6defa; border-radius: 12px; min-width: 76px; min-height: 42px;
      height: 48px; font-weight: bold; font-size: 1.11em;
      text-align: center; vertical-align: middle; color: #111;
      transition: background 0.15s;
      border: 2.3px solid #b2cfe2;
      cursor: pointer; overflow: hidden; position: relative;
      white-space: nowrap;
      box-shadow: 0 1px 4px #0002;
    }
    .grille-table td.drag-over {
      background: #d1fbe7 !important;
      box-shadow: 0 0 0 3px #1a99be, 0 2px 10px #0002;
    }
    .grille-table td.vide { background: #f7fafd; color: #c7c7c7;}
    .export-box { width: 100%; height: 120px; margin-top: 8px; font-family: monospace; }
    .actions { text-align: center; margin-top: 20px; }
    .help { color: #666; font-size: 0.98em; text-align: center; margin-top: 17px;}
    @media (max-width: 900px) {
      .mainzone { flex-direction: column; align-items: center;}
      .grille { max-width: 99vw;}
    }
  </style>
</head>
<body>
  <h1>üü¶ G√©n√©rateur de plan de classe : grille interactive</h1>
  <div class="setup">
    <label>Pr√©noms (un par ligne):</label><br>
    <textarea id="eleves-input" style="width:240px; height:88px;"></textarea>
    <br><br>
    <label>Lignes :</label>
    <input type="number" id="rows-input" value="5" min="1" style="width:3em;">
    &nbsp;
    <label>Colonnes :</label>
    <input type="number" id="cols-input" value="7" min="1" style="width:3em;">
    <br><br>
    <button onclick="genererGrille()">Cr√©er la grille</button>
  </div>

  <div class="mainzone">
    <div>
      <div style="font-weight:bold; text-align:center;">√âl√®ves non plac√©s</div>
      <div class="eleve-list" id="eleve-list"></div>
    </div>
    <div>
      <div class="grille" id="grille"></div>
    </div>
  </div>

  <div class="actions">
    <button onclick="exporterMatrice()">Exporter la matrice</button><br>
    <textarea id="export-output" class="export-box" readonly placeholder="Ici appara√Ætra la matrice √† copier‚Ä¶"></textarea>
  </div>
  <div class="help">
    üü¶ Glisse les √©l√®ves dans la grille, o√π tu veux, puis clique sur "Exporter la matrice"<br>
    üü¶ Les cases vides appara√Ætront comme <b>0</b> dans le code.<br>
    üü¶ Tu peux glisser un √©l√®ve d'une case √† une autre, ou le remettre dans la liste √† gauche.
  </div>

<script>
let eleves = [], rows = 5, cols = 7, matrice = [];
function genererGrille() {
  eleves = document.getElementById('eleves-input').value
    .split('\n').map(x => x.trim()).filter(x => !!x);
  rows = parseInt(document.getElementById('rows-input').value) || 1;
  cols = parseInt(document.getElementById('cols-input').value) || 1;
  matrice = Array.from({length: rows}, () => Array(cols).fill(0));
  document.getElementById('eleve-list').innerHTML = '';
  eleves.forEach(prenom => {
    const e = document.createElement('div');
    e.className = 'eleve';
    e.textContent = prenom;
    e.draggable = true;
    e.ondragstart = ev => {
      ev.dataTransfer.setData("prenom", prenom);
      ev.dataTransfer.setData("from", "list");
    };
    e.dataset.nom = prenom;
    document.getElementById('eleve-list').appendChild(e);
  });
  renderGrille();
}

function renderGrille() {
  const grilleDiv = document.getElementById('grille');
  grilleDiv.innerHTML = '';
  const table = document.createElement('table');
  table.className = 'grille-table';
  for (let r = 0; r < rows; r++) {
    const tr = document.createElement('tr');
    for (let c = 0; c < cols; c++) {
      const td = document.createElement('td');
      td.className = matrice[r][c] ? '' : 'vide';
      td.textContent = matrice[r][c] || '';
      td.ondragover = e => e.preventDefault();
      td.ondragenter = e => td.classList.add('drag-over');
      td.ondragleave = e => td.classList.remove('drag-over');
      td.ondrop = function(e) {
        e.preventDefault();
        td.classList.remove('drag-over');
        const prenom = e.dataTransfer.getData("prenom");
        const from = e.dataTransfer.getData("from");
        if (!prenom) return;
        // Retrait de la position pr√©c√©dente (dans la grille)
        for (let i = 0; i < rows; i++)
          for (let j = 0; j < cols; j++)
            if (matrice[i][j] === prenom)
              matrice[i][j] = 0;
        // Si la case √©tait occup√©e, remet l‚Äôancien √©l√®ve dans la liste √† gauche
        if (matrice[r][c] && matrice[r][c] !== prenom) {
          addEleveToList(matrice[r][c]);
        }
        matrice[r][c] = prenom;
        renderGrille();
        removeEleveFromList(prenom);
      };
      // Permet de retirer un √©l√®ve de la case (en le remettant √† gauche)
      td.onclick = function() {
        if (matrice[r][c]) {
          addEleveToList(matrice[r][c]);
          matrice[r][c] = 0;
          renderGrille();
        }
      };
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  grilleDiv.appendChild(table);
}
function addEleveToList(prenom) {
  // Ne l'ajoute que s'il n'est pas d√©j√† √† gauche
  if ([...document.querySelectorAll('.eleve-list .eleve')].some(e => e.textContent === prenom)) return;
  const e = document.createElement('div');
  e.className = 'eleve';
  e.textContent = prenom;
  e.draggable = true;
  e.ondragstart = ev => {
    ev.dataTransfer.setData("prenom", prenom);
    ev.dataTransfer.setData("from", "list");
  };
  e.dataset.nom = prenom;
  document.getElementById('eleve-list').appendChild(e);
}
function removeEleveFromList(prenom) {
  [...document.querySelectorAll('.eleve-list .eleve')].forEach(e => {
    if (e.textContent === prenom) e.remove();
  });
}

function exporterMatrice() {
  document.getElementById('export-output').value =
    JSON.stringify(matrice, null, 2) +
    "\n// √Ä coller dans la variable matrice de ton site";
}
</script>
</body>
</html>
