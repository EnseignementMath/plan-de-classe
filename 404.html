<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>G√©n√©rateur de plan de classe</title>
  <style>
    body { font-family: sans-serif; background: #f7f7f7; padding: 24px;}
    h1 { text-align: center; }
    .setup, .actions { margin-bottom: 1.5em; text-align: center;}
    .input-list { width: 300px; min-height: 90px; }
    .grille { display: inline-block; background: #e7f5ff; padding: 20px 16px 16px 16px; border-radius: 10px;}
    .row { display: flex; margin-bottom: 8px;}
    .cell {
      min-width: 110px; min-height: 48px; background: #9fdaee; margin-right: 8px;
      border-radius: 15px; display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 1.25em; color: #111;
      position: relative;
      border: 2px solid #a4d4ed;
      transition: box-shadow 0.2s;
      box-shadow: 0 2px 10px #0002;
      cursor: pointer;
      overflow: hidden;
    }
    .cell.drag-over {
      box-shadow: 0 0 0 3px #0064A4, 0 2px 10px #0003;
      background: #e6ffef;
    }
    .cell.empty { background: #c6e4ef; color: #aaa;}
    .eleve-list {
      display: flex; flex-wrap: wrap; gap: 7px; margin: 12px 0 22px 0; justify-content: center;
    }
    .eleve {
      background: #fff; border-radius: 10px; padding: 8px 16px; margin: 2px;
      box-shadow: 0 1px 4px #0001;
      font-size: 1.07em; cursor: grab; border: 1.5px solid #9ad6eb; user-select: none;
      transition: box-shadow .2s, background .2s;
      display: inline-block;
    }
    .eleve:active { background: #d7f7ee;}
    .export-box { width: 100%; height: 110px; margin-top: 10px; font-family: monospace;}
    label { font-weight: bold;}
    .actions { margin-top: 2em; }
    .help { font-size: 0.97em; color: #777; margin-top: 1.3em;}
  </style>
</head>
<body>
  <h1>üß© G√©n√©rateur de plan de classe - Drag & Drop</h1>
  <div class="setup">
    <label>Liste des pr√©noms (un pr√©nom par ligne):</label><br>
    <textarea id="eleves-input" class="input-list" placeholder="Pr√©nom 1&#10;Pr√©nom 2&#10;Pr√©nom 3"></textarea>
    <br><br>
    <label>Taille de la grille : </label>
    <input type="number" id="rows-input" value="5" min="1" style="width:3em;"> lignes √ó
    <input type="number" id="cols-input" value="6" min="1" style="width:3em;"> colonnes
    <br><br>
    <button onclick="genererGrille()">G√©n√©rer la grille</button>
  </div>

  <div class="eleve-list" id="eleve-list"></div>

  <div id="grille-zone" class="grille"></div>

  <div class="actions">
    <button onclick="exporterJSON()">Exporter la matrice</button>
    <br>
    <textarea id="export-output" class="export-box" readonly placeholder="Ici appara√Ætra la matrice √† copier‚Ä¶"></textarea>
  </div>

  <div class="help">
    - Glisse chaque √©l√®ve dans la case voulue. <br>
    - Tu peux laisser des cases vides pour marquer un "espace".<br>
    - Clique sur "Exporter la matrice" pour obtenir le code √† copier dans ton site.<br>
    <b>Astuce :</b> Rel√¢che un √©l√®ve sur une case d√©j√† occup√©e pour √©changer les positions.
  </div>

<script>
let eleves = [], rows = 5, cols = 6;
let grille = []; // Matrice

function genererGrille() {
  // R√©cup√®re les pr√©noms et dimensions
  eleves = document.getElementById('eleves-input').value
    .split('\n').map(x => x.trim()).filter(x => !!x);
  rows = parseInt(document.getElementById('rows-input').value) || 1;
  cols = parseInt(document.getElementById('cols-input').value) || 1;

  // Initialise la grille vide
  grille = Array.from({length: rows}, () => Array(cols).fill(''));
  document.getElementById('grille-zone').innerHTML = '';
  document.getElementById('eleve-list').innerHTML = '';

  // Affiche les pr√©noms non plac√©s √† gauche
  eleves.forEach(prenom => {
    const e = document.createElement('div');
    e.className = 'eleve';
    e.textContent = prenom;
    e.draggable = true;
    e.ondragstart = dragStart;
    e.dataset.nom = prenom;
    document.getElementById('eleve-list').appendChild(e);
  });

  // Affiche la grille
  for (let r = 0; r < rows; r++) {
    const ligne = document.createElement('div');
    ligne.className = 'row';
    for (let c = 0; c < cols; c++) {
      const cell = document.createElement('div');
      cell.className = 'cell empty';
      cell.dataset.row = r;
      cell.dataset.col = c;
      cell.ondrop = cellDrop;
      cell.ondragover = cellDragOver;
      cell.ondragenter = cellDragEnter;
      cell.ondragleave = cellDragLeave;
      ligne.appendChild(cell);
    }
    document.getElementById('grille-zone').appendChild(ligne);
  }
}

let dragData = null;

function dragStart(ev) {
  dragData = {nom: ev.target.dataset.nom};
  ev.dataTransfer.effectAllowed = "move";
}

function cellDragOver(ev) {
  ev.preventDefault();
}

function cellDragEnter(ev) {
  ev.preventDefault();
  ev.target.classList.add('drag-over');
}
function cellDragLeave(ev) {
  ev.target.classList.remove('drag-over');
}

function cellDrop(ev) {
  ev.preventDefault();
  ev.target.classList.remove('drag-over');
  const prenom = dragData.nom;
  if (!prenom) return;

  // Retire l'√©l√®ve de la liste non plac√©e
  Array.from(document.getElementsByClassName('eleve')).forEach(e => {
    if (e.dataset.nom === prenom) e.remove();
  });

  // Si la case est d√©j√† occup√©e, √©change les √©l√®ves
  let r = ev.target.dataset.row, c = ev.target.dataset.col;
  let precedent = grille[r][c];
  grille[r][c] = prenom;
  ev.target.textContent = prenom;
  ev.target.classList.remove('empty');
  ev.target.classList.add('occup');
  ev.target.style.background = "#8ed2ee";
  ev.target.style.color = "#111";
  ev.target.style.fontWeight = "bold";

  // Replace l'√©l√®ve √©vinc√© dans la liste
  if (precedent && precedent !== prenom) {
    const old = document.createElement('div');
    old.className = 'eleve';
    old.textContent = precedent;
    old.draggable = true;
    old.ondragstart = dragStart;
    old.dataset.nom = precedent;
    document.getElementById('eleve-list').appendChild(old);
  }
}

function exporterJSON() {
  // Reconstruit la matrice actuelle en tenant compte des cellules vides
  let matrice = [];
  let rows = document.getElementsByClassName('row');
  for (let i = 0; i < rows.length; i++) {
    let ligne = [];
    let cells = rows[i].getElementsByClassName('cell');
    for (let j = 0; j < cells.length; j++) {
      let val = cells[j].textContent.trim();
      ligne.push(val === "" ? 0 : val);
    }
    matrice.push(ligne);
  }
  document.getElementById('export-output').value =
    JSON.stringify(matrice, null, 2)
    + "\n// √Ä coller dans ta variable matrice dans ton code !";
}

</script>
</body>
</html>

